define("discourse/plugins/discourse-policy/discourse/components/policy-form-field",["exports","@ember/component"],(function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=t.default.extend({tagName:""});e.default=o})),define("discourse/plugins/discourse-policy/discourse/components/policy-group-input",["exports","@ember/component","@ember/object"],(function(e,t,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,s,c,a,r,l,p=t.default.extend((i={group:null,onChangeGroup:null,siteGroups:(0,o.computed)("site.groups",(function(){return(this.site.groups||[]).map((function(e){if(0!==e.id)return e.name})).filter(Boolean)})),onChange:function(e){this.onChangeGroup&&this.onChangeGroup(e)}},n=i,s="onChange",c=[o.action],a=Object.getOwnPropertyDescriptor(i,"onChange"),r=i,l={},Object.keys(a).forEach((function(e){l[e]=a[e]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=c.slice().reverse().reduce((function(e,t){return t(n,s,e)||e}),l),r&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),void 0===l.initializer&&(Object.defineProperty(n,s,l),l=null),i));e.default=p})),define("discourse/plugins/discourse-policy/discourse/components/policy-reminder-input",["exports","@ember/component","I18n"],(function(e,t,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=[{id:"daily",name:o.default.t("daily")},{id:"weekly",name:o.default.t("weekly")}],n=t.default.extend({reminder:null,onChangeReminder:null,validReminders:i});e.default=n})),define("discourse/plugins/discourse-policy/discourse/components/post-policy",["exports","@ember/component","@ember/object","discourse-common/lib/get-url","discourse-common/utils/decorators","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/show-modal","javascripts/components/post-policy"],(function(e,t,o,i,n,s,c,a,r){"use strict";var l,p,u,d,y,f,m,_;function b(e,t,o,i,n){var s={};return Object.keys(i).forEach((function(e){s[e]=i[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=o.slice().reverse().reduce((function(o,i){return i(e,t,o)||o}),s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var v=t.default.extend((l=(0,n.default)("post.policy_accepted","post.policy_revoked"),p=(0,n.default)("post.policy_accepted","post.policy_revoked"),u=(0,n.default)("post.policy_accepted_by_count","post.policy_accepted_by.[]"),d=(0,n.default)("post.policy_accepted_by.[]"),y=(0,n.default)("post.policy_not_accepted_by_count","post.policy_not_accepted_by.[]"),f=(0,n.default)("post.policy_not_accepted_by.[]"),m=(0,n.default)("currentUser.{id,staff}","post.user_id"),_={layout:r.default,tagName:"",post:null,options:null,showNotAccepted:!1,isLoading:!1,form:null,init:function(){this._super.apply(this,arguments),this.post.setProperties({policy_accepted_by:this.post.policy_accepted_by||[],policy_not_accepted_by:this.post.policy_not_accepted_by||[]})},didInsertElement:function(){this._super.apply(this,arguments),this.appEvents.on("policy:changed",this,"policyChanged")},willDestroyElement:function(){this._super.apply(this,arguments),this.appEvents.off("policy:changed",this,"policyChanged")},policyChanged:function(e){var t=this,o=e.controller.get("model.postStream").findLoadedPost(e.message.id);if(o){var n=(0,i.default)("/posts/".concat(o.id,".json"));(0,s.ajax)(n).then((function(e){t.post.setProperties({policy_can_accept:e.policy_can_accept,policy_can_revoke:e.policy_can_revoke,policy_accepted:e.policy_accepted,policy_revoked:e.policy_revoked,policy_not_accepted_by:e.policy_not_accepted_by||[],policy_not_accepted_by_count:e.policy_not_accepted_by_count,policy_accepted_by:e.policy_accepted_by||[],policy_accepted_by_count:e.policy_accepted_by_count})}))}},acceptButtonClasses:function(e,t){var o="accept btn-accept-policy";return!e&&t||(o+=" btn-primary"),o},revokeButtonClasses:function(e,t){var o="accept btn-accept-policy";return!t&&e||(o+=" btn-danger"),o},remainingAcceptedUsers:function(e,t){return e-t.length},acceptedUsers:function(){return this.post.policy_accepted_by||[]},remainingNotAcceptedUsers:function(e,t){return e-t.length},notAcceptedUsers:function(){return this.post.policy_not_accepted_by||[]},canManagePolicy:function(){return this.currentUser&&(this.currentUser.staff||this.currentUser.id===this.post.user_id)},_updatePolicy:function(e,t){var o=this;return this.set("isLoading",!0),(0,s.ajax)((0,i.default)("/policy/".concat(e)),{type:"put",data:{post_id:t}}).catch(c.popupAjaxError).finally((function(){return o.set("isLoading",!1)}))},revokePolicy:function(){this.post.policy_not_accepted_by.pushObject(this.currentUser),this.post.set("policy_not_accepted_by_count",this.post.policy_not_accepted_by_count+1);var e=this.post.policy_accepted_by.findBy("id",this.currentUser.id);e&&(this.post.policy_accepted_by.removeObject(e),this.post.set("policy_accepted_by_count",this.post.policy_accepted_by_count-1)),this.post.policy_can_accept!==this.post.policy_can_revoke&&this.post.set({policy_can_accept:!0,policy_can_revoke:!1,policy_accepted:!1,policy_revoked:!0}),this._updatePolicy("unaccept",this.post.id)},acceptPolicy:function(){this.post.policy_accepted_by.pushObject(this.currentUser),this.post.set("policy_accepted_by_count",this.post.policy_accepted_by_count+1);var e=this.post.policy_not_accepted_by.findBy("id",this.currentUser.id);e&&(this.post.policy_not_accepted_by.removeObject(e),this.post.set("policy_not_accepted_by_count",this.post.policy_not_accepted_by_count-1)),this.post.policy_can_accept!==this.post.policy_can_revoke&&this.post.setProperties({policy_can_accept:!1,policy_can_revoke:!0,policy_accepted:!0,policy_revoked:!1}),this._updatePolicy("accept",this.post.id)},loadRemainingAcceptedUsers:function(){var e=this;(0,s.ajax)((0,i.default)("/policy/accepted"),{data:{post_id:this.post.id,offset:this.post.policy_accepted_by.length}}).then((function(t){t.users.forEach((function(t){e.post.policy_accepted_by.pushObject(t)}))})).catch(c.popupAjaxError)},loadRemainingNotAcceptedUsers:function(){var e=this;(0,s.ajax)((0,i.default)("/policy/accepted"),{data:{post_id:this.post.id,offset:this.post.policy_not_accepted_by.length}}).then((function(t){t.users.forEach((function(t){e.post.policy_not_accepted_by.pushObject(t)}))})).catch(c.popupAjaxError)},editPolicy:function(){(0,a.default)("policy-builder").setProperties({insertMode:!1,post:this.post,form:this.form})},toggleShowUsers:function(){this.toggleProperty("showNotAccepted")}},b(_,"policyChanged",[n.bind],Object.getOwnPropertyDescriptor(_,"policyChanged"),_),b(_,"acceptButtonClasses",[l],Object.getOwnPropertyDescriptor(_,"acceptButtonClasses"),_),b(_,"revokeButtonClasses",[p],Object.getOwnPropertyDescriptor(_,"revokeButtonClasses"),_),b(_,"remainingAcceptedUsers",[u],Object.getOwnPropertyDescriptor(_,"remainingAcceptedUsers"),_),b(_,"acceptedUsers",[d],Object.getOwnPropertyDescriptor(_,"acceptedUsers"),_),b(_,"remainingNotAcceptedUsers",[y],Object.getOwnPropertyDescriptor(_,"remainingNotAcceptedUsers"),_),b(_,"notAcceptedUsers",[f],Object.getOwnPropertyDescriptor(_,"notAcceptedUsers"),_),b(_,"canManagePolicy",[m],Object.getOwnPropertyDescriptor(_,"canManagePolicy"),_),b(_,"revokePolicy",[o.action],Object.getOwnPropertyDescriptor(_,"revokePolicy"),_),b(_,"acceptPolicy",[o.action],Object.getOwnPropertyDescriptor(_,"acceptPolicy"),_),b(_,"loadRemainingAcceptedUsers",[o.action],Object.getOwnPropertyDescriptor(_,"loadRemainingAcceptedUsers"),_),b(_,"loadRemainingNotAcceptedUsers",[o.action],Object.getOwnPropertyDescriptor(_,"loadRemainingNotAcceptedUsers"),_),b(_,"editPolicy",[o.action],Object.getOwnPropertyDescriptor(_,"editPolicy"),_),b(_,"toggleShowUsers",[o.action],Object.getOwnPropertyDescriptor(_,"toggleShowUsers"),_),_));e.default=v})),define("discourse/plugins/discourse-policy/discourse/controllers/policy-builder",["exports","@ember/utils","I18n","discourse/lib/text","discourse/mixins/modal-functionality","@ember/controller","@ember/object","discourse-common/lib/get-url","discourse/lib/ajax"],(function(e,t,o,i,n,s,c,a,r){"use strict";var l;function p(e,t,o,i,n){var s={};return Object.keys(i).forEach((function(e){s[e]=i[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=o.slice().reverse().reduce((function(o,i){return i(e,t,o)||o}),s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=s.default.extend(n.default,(p(l={toolbarEvent:null,form:null,post:null,isSaving:!1,insertMode:!0,onShow:function(){this.form||this.set("form",c.default.create({reminder:"daily",version:1}))},onClose:function(){this.set("form",null)},insertPolicy:function(){if(this._validateForm(this.form)){var e=this._buildParams(this.form);this.toolbarEvent.addText("\n\n[policy ".concat(e.join(" "),"]\n[/policy]\n\n")),this.send("closeModal")}},updatePolicy:function(){var e=this;if(this._validateForm(this.form)){this.set("isSaving",!0);var t=(0,a.default)("/posts/".concat(this.post.id));return(0,r.ajax)(t,{type:"GET",cache:!1}).then((function(t){var n=t.raw,s=e._replaceRaw(e.form,n);if(s){var c={raw:s,edit_reason:o.default.t("discourse_policy.edit_reason")};return i.default.cookAsync(n).then((function(t){c.cooked=t.string,e.post.save(c)}))}})).finally((function(){e.set("isSaving",!1),e.send("closeModal")}))}},onChangeRenewStartChange:function(e){this.form.set("renew-start",e)},_buildParams:function(e){var o=[];return Object.keys(e).forEach((function(i){var n=e[i];n&&(0,t.isPresent)(n)&&o.push("".concat(i,'="').concat(n,'"'))})),o},_replaceRaw:function(e,t){var o=new RegExp("\\[policy\\s(.*?)\\]","m"),i=t.match(o);if(i&&i[1]){var n=this._buildParams(e);return t.replace(o,"[policy ".concat(n.join(" "),"]"))}return!1},_validateForm:function(e){return e.group&&(0,t.isPresent)(e.group)?!(!e.version||!(0,t.isPresent)(e.version))||(this.flash(o.default.t("discourse_policy.builder.errors.version"),"error"),!1):(this.flash(o.default.t("discourse_policy.builder.errors.group"),"error"),!1)}},"insertPolicy",[c.action],Object.getOwnPropertyDescriptor(l,"insertPolicy"),l),p(l,"updatePolicy",[c.action],Object.getOwnPropertyDescriptor(l,"updatePolicy"),l),p(l,"onChangeRenewStartChange",[c.action],Object.getOwnPropertyDescriptor(l,"onChangeRenewStartChange"),l),l));e.default=u})),Ember.TEMPLATES["javascripts/components/policy-form-field"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["&default"],"statements":[[7,"div",true],[11,"class",[29,["policy-field ",[22,"name"]]]],[8],[0,"\\n  "],[7,"div",true],[10,"class","policy-field-label"],[8],[0,"\\n    "],[7,"span",true],[10,"class","label"],[8],[0,"\\n      "],[1,[28,"i18n",[[28,"concat",["discourse_policy.builder.",[24,["name"]],".label"],null]],null],false],[0,"\\n"],[4,"if",[[24,["mandatory"]]],null,{"statements":[[0,"        "],[7,"span",true],[10,"class","mandatory-field"],[8],[0,"*"],[9],[0,"\\n"]],"parameters":[]},null],[0,"    "],[9],[0,"\\n  "],[9],[0,"\\n  "],[7,"div",true],[10,"class","policy-field-control"],[8],[0,"\\n    "],[14,1],[0,"\\n  "],[9],[0,"\\n  "],[7,"span",true],[10,"class","policy-field-description"],[8],[0,"\\n    "],[7,"span",true],[10,"class","description"],[8],[1,[28,"i18n",[[28,"concat",["discourse_policy.builder.",[24,["name"]],".description"],null]],null],false],[9],[0,"\\n  "],[9],[0,"\\n"],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/components/policy-form-field"}}),Ember.TEMPLATES["javascripts/components/policy-group-input"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"group-chooser",null,[["content","valueProperty","nameProperty","value","onChange","options"],[[24,["siteGroups"]],null,null,[24,["group"]],[28,"action",[[23,0,[]],"onChange"],null],[28,"hash",null,[["maximum"],[1]]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/components/policy-group-input"}}),Ember.TEMPLATES["javascripts/components/policy-reminder-input"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"combo-box",null,[["value","content","onChange"],[[24,["reminder"]],[24,["validReminders"]],[24,["onChangeReminder"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/components/policy-reminder-input"}}),Ember.TEMPLATES["javascripts/components/post-policy"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["notAcceptedUser","acceptedUser"],"statements":[[7,"div",true],[10,"class","policy-footer"],[8],[0,"\\n  "],[7,"div",true],[10,"class","policy-actions"],[8],[0,"\\n"],[4,"if",[[24,["post","policy_can_accept"]]],null,{"statements":[[0,"      "],[1,[28,"d-button",null,[["isLoading","action","class","translatedLabel","icon"],[[24,["isLoading"]],[28,"action",[[23,0,[]],"acceptPolicy"],null],[24,["acceptButtonClasses"]],[24,["options","acceptText"]],[28,"if",[[24,["post","policy_accepted"]],"check"],null]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[4,"if",[[24,["post","policy_can_revoke"]]],null,{"statements":[[0,"      "],[1,[28,"d-button",null,[["isLoading","action","class","translatedLabel","icon"],[[24,["isLoading"]],[28,"action",[[23,0,[]],"revokePolicy"],null],[24,["revokeButtonClasses"]],[24,["options","revokeText"]],[28,"if",[[24,["post","policy_revoked"]],"check"],null]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"  "],[9],[0,"\\n\\n  "],[7,"div",true],[10,"class","user-lists"],[8],[0,"\\n"],[4,"if",[[24,["post","policy_accepted_by_count"]]],null,{"statements":[[0,"      "],[7,"a",false],[12,"href",""],[12,"class","toggle toggle-accepted"],[12,"title",[28,"i18n",["discourse_policy.accepted_tooltip"],null]],[3,"action",[[23,0,[]],"toggleShowUsers"]],[8],[0,"\\n        "],[7,"span",true],[10,"class","user-count"],[8],[0,"\\n          "],[1,[24,["post","policy_accepted_by_count"]],false],[0,"\\n        "],[9],[0,"\\n        "],[1,[28,"d-icon",["user-check"],null],false],[0,"\\n      "],[9],[0,"\\n\\n"],[4,"unless",[[24,["showNotAccepted"]]],null,{"statements":[[0,"        "],[7,"div",true],[10,"class","users accepted"],[8],[0,"\\n"],[4,"each",[[24,["acceptedUsers"]]],null,{"statements":[[0,"            "],[1,[28,"avatar",[[23,2,[]]],[["imageSize"],["tiny"]]],false],[0,"\\n"]],"parameters":[2]},null],[0,"\\n"],[4,"if",[[24,["remainingAcceptedUsers"]]],null,{"statements":[[0,"            "],[7,"a",false],[12,"href",""],[12,"class","load-more-users"],[3,"action",[[23,0,[]],"loadRemainingAcceptedUsers"]],[8],[0,"\\n              + "],[1,[22,"remainingAcceptedUsers"],false],[0," "],[1,[28,"d-icon",["user"],null],false],[0,"\\n            "],[9],[0,"\\n"]],"parameters":[]},null],[0,"        "],[9],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},null],[0,"\\n"],[4,"if",[[24,["post","policy_not_accepted_by_count"]]],null,{"statements":[[0,"      "],[7,"div",true],[10,"class","seperator"],[8],[9],[0,"\\n\\n      "],[7,"a",false],[12,"href",""],[12,"class","toggle toggle-not-accepted"],[12,"title",[28,"i18n",["discourse_policy.not_accepted_tooltip"],null]],[3,"action",[[23,0,[]],"toggleShowUsers"]],[8],[0,"\\n        "],[7,"span",true],[10,"class","user-count"],[8],[0,"\\n          "],[1,[24,["post","policy_not_accepted_by_count"]],false],[0,"\\n        "],[9],[0,"\\n        "],[1,[28,"d-icon",["user-times"],null],false],[0,"\\n      "],[9],[0,"\\n\\n"],[4,"if",[[24,["showNotAccepted"]]],null,{"statements":[[0,"        "],[7,"div",true],[10,"class","users not-accepted"],[8],[0,"\\n"],[4,"each",[[24,["notAcceptedUsers"]]],null,{"statements":[[0,"            "],[1,[28,"avatar",[[23,1,[]]],[["imageSize"],["tiny"]]],false],[0,"\\n"]],"parameters":[1]},null],[0,"\\n"],[4,"if",[[24,["remainingNotAcceptedUsers"]]],null,{"statements":[[0,"            "],[7,"a",false],[12,"href",""],[12,"class","load-more-users"],[3,"action",[[23,0,[]],"loadRemainingNotAcceptedUsers"]],[8],[0,"\\n              + "],[1,[22,"remainingNotAcceptedUsers"],false],[0," "],[1,[28,"d-icon",["user"],null],false],[0,"\\n            "],[9],[0,"\\n"]],"parameters":[]},null],[0,"        "],[9],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},null],[0,"  "],[9],[0,"\\n\\n"],[4,"if",[[24,["canManagePolicy"]]],null,{"statements":[[0,"    "],[1,[28,"d-button",null,[["class","icon","action"],["no-text btn-default edit-policy-settings-btn","cog",[28,"action",[[23,0,[]],"editPolicy"],null]]]],false],[0,"\\n"]],"parameters":[]},null],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/components/post-policy"}}),Ember.TEMPLATES["javascripts/modal/policy-builder"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"d-modal-body",null,[["title","class"],[[28,"concat",["discourse_policy.builder.title"],null],"policy-builder"]],{"statements":[[4,"policy-form-field",null,[["name","mandatory"],["group",true]],{"statements":[[0,"    "],[1,[28,"policy-group-input",null,[["group","onChangeGroup"],[[24,["form","group"]],[28,"action",[[23,0,[]],[28,"mut",[[24,["form","group"]]],null]],null]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[4,"policy-form-field",null,[["name","mandatory"],["version",true]],{"statements":[[0,"    "],[1,[28,"input",null,[["name","type","value","input"],["version","number",[24,["form","version"]],[28,"action",[[23,0,[]],[28,"mut",[[24,["form","version"]]],null]],[["value"],["target.value"]]]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[4,"policy-form-field",null,[["name"],["renew"]],{"statements":[[0,"    "],[1,[28,"input",null,[["name","type","value","input"],["renew","number",[24,["form","renew"]],[28,"action",[[23,0,[]],[28,"mut",[[24,["form","renew"]]],null]],[["value"],["target.value"]]]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[4,"policy-form-field",null,[["name"],["renew-start"]],{"statements":[[0,"    "],[1,[28,"input",null,[["type","placeholder","name","value","input"],["date","2020-03-31","renew-start",[28,"get",[[24,["form"]],"renew-start"],null],[28,"action",[[23,0,[]],"onChangeRenewStartChange"],[["value"],["target.value"]]]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[4,"policy-form-field",null,[["name"],["reminder"]],{"statements":[[0,"    "],[1,[28,"policy-reminder-input",null,[["reminder","onChangeReminder"],[[24,["form","reminder"]],[28,"action",[[23,0,[]],[28,"mut",[[24,["form","reminder"]]],null]],null]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[4,"policy-form-field",null,[["name"],["accept"]],{"statements":[[0,"    "],[1,[28,"input",null,[["type","value","input"],["text",[24,["form","accept"]],[28,"action",[[23,0,[]],[28,"mut",[[24,["form","accept"]]],null]],[["value"],["target.value"]]]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[4,"policy-form-field",null,[["name"],["revoke"]],{"statements":[[0,"    "],[1,[28,"input",null,[["type","value","input"],["text",[24,["form","revoke"]],[28,"action",[[23,0,[]],[28,"mut",[[24,["form","revoke"]]],null]],[["value"],["target.value"]]]]]],false],[0,"\\n"]],"parameters":[]},null],[0,"\\n"],[4,"policy-form-field",null,[["name"],["private"]],{"statements":[[0,"    "],[1,[28,"input",null,[["type","checked"],["checkbox",[24,["form","private"]]]]],false],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},null],[0,"\\n"],[7,"div",true],[10,"class","modal-footer"],[8],[0,"\\n"],[4,"if",[[24,["insertMode"]]],null,{"statements":[[0,"    "],[1,[28,"d-button",null,[["type","class","label","action"],["button","btn-primary","discourse_policy.builder.insert",[28,"action",[[23,0,[]],"insertPolicy"],null]]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"    "],[1,[28,"d-button",null,[["isLoading","type","class","label","action"],[[24,["isSaving"]],"button","btn-primary","discourse_policy.builder.save",[28,"action",[[23,0,[]],"updatePolicy"],null]]]],false],[0,"\\n"]],"parameters":[]}],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/modal/policy-builder"}}),define("discourse/plugins/discourse-policy/initializers/add-policy-builder",["exports","discourse/lib/plugin-api","discourse/lib/show-modal"],(function(e,t,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={name:"add-discourse-policy-builder",initialize:function(e){e.lookup("site-settings:main").policy_enabled&&(0,t.withPluginApi)("0.8.7",(function(t){return function(e,t){var i=e.getCurrentUser(),n=t.lookup("site-settings:main");e.addToolbarPopupMenuOptionsCallback((function(){if(i)return!n.policy_restrict_to_staff_posts||i.staff?{label:"discourse_policy.builder.attach",id:"insertPolicy",group:"insertions",icon:"file-signature",action:"insertPolicy"}:void 0})),e.modifyClass("controller:composer",{pluginId:"discourse-policy",actions:{insertPolicy:function(){(0,o.default)("policy-builder").setProperties({toolbarEvent:this.toolbarEvent})}}})}(t,e)}))}};e.default=i})),define("discourse/plugins/discourse-policy/initializers/extend-for-policy",["exports","@ember/object","I18n","discourse/lib/plugin-api","discourse/lib/utilities"],(function(e,t,o,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=[{name:"group",visible:!0},{name:"version",visible:!0,optional:!0},{name:"renew",visible:!0,optional:!0},{name:"renew-start",camelName:"renewStart",visible:!0,optional:!0},{name:"reminder",optional:!0},{name:"accept",optional:!0},{name:"revoke",optional:!0}];function c(e){function i(e){var o={};return s.forEach((function(t){o[t.name]=e.dataset[t.camelName||t.name]||""})),(!o.version||parseInt(o.version,10)<1)&&(o.version=1),o.private="true"===e.dataset.private,t.default.create(o)}e.decorateCookedElement((function(t,s){var c=t.querySelector(".policy");if(c){if(c.innerHTML='<div class="policy-body">'.concat(c.innerHTML,"</div>"),!s){var a=document.createElement("div");return a.classList.add("policy-preview"),a.innerText=o.default.t("discourse_policy.title"),void c.prepend(a)}var r=s.getModel(),l=e.container.owner.factoryFor("component:post-policy").create({post:r,form:i(c),options:{revokeText:(0,n.escapeExpression)(c.dataset.revoke||o.default.t("discourse_policy.revoke_policy")),acceptText:(0,n.escapeExpression)(c.dataset.accept||o.default.t("discourse_policy.accept_policy"))}});l.renderer.appendTo(l,c)}}),{onlyStream:!1,id:"discouse-policy"}),e.registerCustomPostMessageCallback("policy_change",(function(e,t){e.appEvents.trigger("policy:changed",{controller:e,message:t})}))}var a={name:"extend-for-policy",initialize:function(){(0,i.withPluginApi)("0.8.7",c)}};e.default=a})),define("discourse/plugins/discourse-policy/lib/discourse-markdown/policy",["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setup=function(e){e.allowList(["div.policy"]),e.registerOptions((function(e,t){e.features.policy=!!t.policy_enabled})),e.registerPlugin((function(e){e.block.bbcode.ruler.push("policy",t)}))};var t={tag:"policy",wrap:function(e,t){return!!t.attrs.group&&(e.attrs=[["class","policy"],["data-group",t.attrs.group]],e.attrs.push(["data-version",t.attrs.version||1]),t.attrs.renew&&e.attrs.push(["data-renew",t.attrs.renew]),t.attrs.reminder&&e.attrs.push(["data-reminder",t.attrs.reminder]),t.attrs.accept&&e.attrs.push(["data-accept",t.attrs.accept]),t.attrs.revoke&&e.attrs.push(["data-revoke",t.attrs.revoke]),t.attrs.start&&e.attrs.push(["data-renew-start",t.attrs.start]),t.attrs.private&&e.attrs.push(["data-private",t.attrs.private]),!0)}}})),define("discourse/plugins/discourse-policy/pre-initializers/define-policy-templates",["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t={name:"define-policy-templates",after:"inject-discourse-objects",initialize:function(){var e="javascripts/components/post-policy";define(e,(function(){return Ember.TEMPLATES[e]}))}};e.default=t}));
//# sourceMappingURL=discourse-policy-baf8ae929817a7e5fc7e6ce5c93762a5eba79a138259a491fe81daf5db46173c.js.map